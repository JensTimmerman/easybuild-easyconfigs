easyblock = 'PythonPackage'
name = 'QIIME'
version = '1.7.0'

homepage = 'http://qiime.sourceforge.net/'
description = """QIIME (canonically pronounced 'Chime') is a pipeline for performing microbial community analysis that
 integrates many third party tools which have become standard in the field."""

toolchain = {'name': 'goolf', 'version': '1.4.10'}

toolchainopts = {'pic': True, 'opt': True, 'optarch': True}

sources = [SOURCELOWER_TAR_GZ]
source_urls = ['ftp://thebeast.colorado.edu/pub/qiime-releases/']

pythonversion = '2.7.5'
versionsuffix = '-Python-%s' % pythonversion
dependencies = [
    ('Python', pythonversion),  # numpy
    ('biom-format', '1.1.2'),
    ('PyCogent', '1.5.3', versionsuffix),

    # needed for PyNAST (greengenes data files can be installed by the user?)
    ('UCLUST', 'q1.2.22_i86linux64', '', True),
    ('PyNAST', '1.2', versionsuffix),
    ('FastTree', '2.1.3', '-omp'),
    #('Java', '1.7.0_15'),
    #('RDP-Classifier', '2.2'),
    #('tax2tree', '1.0.0'),

    ## for visualization
    ('matplotlib','1.2.1', '-Python-%s' % pythonversion),
    # cytoscape

    # for alternative pipelines
    #('BLAST', '2.2.22-x64-linux'),  # this exact version

    # optional for now
    #('CD-HIT', '2009-0427', '-omp'),
    #('microbiomeutil', '2010-04-29'),
    #('mothur', '1.25.0'),
    #('clearcut', '1.0.9'),
    #('raxml', '7.3.0'),
    #('infernal', '1.0.2'),
    #('cdbtools', '??'),
    #('muscle', '3.5.31'),
    #('rtax', '0.983'),
    #('pplacer', ''),
    #('Denoiser', '0.851'),

]

# ???
importdeps = 'cogent, numpy, matplotlib, pynast'

testinstall = True
runtest = "export PYTHONPATH=$PYTHONPATH:$PWD && export PATH=$PATH:$PWD/scripts && cd tests && python all_tests.py"
